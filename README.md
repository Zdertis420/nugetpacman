
# NuGet Dependency Graph Builder

Этот проект — **Python-скрипт** для анализа и построения графа зависимостей NuGet-пакетов с использованием официального API NuGet V3.  
Поддерживается поиск пакетов, получение версий, извлечение зависимостей и построение графа в глубину (DFS) с фильтрацией по фреймворку и исключению пакетов.

---

## Особенности

- **Поиск пакетов** через `SearchQueryService`
- **Получение всех версий** пакета через `RegistrationsBaseUrl`
- **Извлечение зависимостей** для конкретной версии (с поддержкой `dependencyGroups`)
- **Построение графа зависимостей** с использованием **нерекурсивного DFS**
- **Фильтрация по целевому фреймворку** (например, `.NETStandard,2.0`, `.NETFramework,4.6.1`)
- **Исключение пакетов** по подстроке (например, `Microsoft`, `System`)
- **Сортировка версий** с учётом семантического версионирования (SemVer)
- **Обработка страниц (pagination)** в регистрационных данных
- **Красивый вывод графа** в консоль

---

## Требования

- Python 3.7+
- `requests` — для HTTP-запросов

```bash
pip install requests
```

---

## Установка

1. Склонируйте репозиторий или скачайте `parser.py`
2. Установите зависимости:

```bash
pip install requests urllib json
```
---

## Использование

### Запуск из командной строки

```bash
python parser.py
```

### Настройка параметров

Измените значения в блоке `if __name__ == "__main__":`:

```python
START_PACKAGE = "Serilog"           # Имя пакета
FRAMEWORK_FILTER = None             # Например: ".NETStandard,2.0"
EXCLUDE_FILTER = "Microsoft"        # Исключить пакеты, содержащие эту подстроку
```

#### Примеры:

```python
START_PACKAGE = "Newtonsoft.Json"
FRAMEWORK_FILTER = ".NETStandard,2.0"
EXCLUDE_FILTER = "Microsoft"
```

---

## Вывод

Программа выведет **два графа**:

1. **С фильтрацией** (если задан `EXCLUDE_FILTER`)
2. **Полный граф** (без исключений)

```
--- Граф зависимостей (Пакет -> [Зависимости]) ---

Serilog:
  -> Serilog.Sinks.Console
  -> Serilog.Sinks.File

Serilog.Sinks.Console:
  (нет зависимостей)
```

---

## Функции

| Функция | Описание |
|-------|---------|
| `get_nuget_service_index()` | Получает индекс сервисов NuGet V3 |
| `find_resource_url()` | Находит URL нужного сервиса |
| `search_packages()` | Поиск пакетов по запросу |
| `get_package_versions()` | Все версии пакета (сортировка по убыванию) |
| `get_package_dependencies()` | Прямые зависимости для версии |
| `version_to_key()` | Ключ для корректной сортировки SemVer |
| `build_dependency_graph_dfs()` | Построение графа (DFS, итеративно) |
| `print_graph()` | Красивый вывод графа |

---

## Ограничения

- Используется **последняя версия** каждой зависимости
- Не поддерживает **версионные диапазоны** при выборе зависимостей
- Не кэширует запросы (можно добавить `cache` или `functools.lru_cache`)
- Ошибки сети могут прервать выполнение (частичные результаты сохраняются)

---

## Примеры использования

```python
graph = build_dependency_graph_dfs(
    "EntityFramework",
    "6.4.4",
    framework=".NETFramework,4.6.1",
    exclude_substring="Microsoft"
)
print_graph(graph)
```
